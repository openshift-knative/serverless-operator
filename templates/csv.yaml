apiVersion: operators.coreos.com/v1alpha1
kind: ClusterServiceVersion
metadata:
  annotations:
    operatorframework.io/suggested-namespace: "openshift-serverless"
    operators.openshift.io/infrastructure-features: '["disconnected", "proxy-aware"]'
    operators.openshift.io/valid-subscription: '["OpenShift Container Platform", "OpenShift Platform Plus"]'
    features.operators.openshift.io/disconnected: "true"
    features.operators.openshift.io/fips-compliant: "false"
    features.operators.openshift.io/proxy-aware: "true"
    features.operators.openshift.io/tls-profiles: "false"
    features.operators.openshift.io/token-auth-aws: "false"
    features.operators.openshift.io/token-auth-azure: "false"
    features.operators.openshift.io/token-auth-gcp: "false"
    features.operators.openshift.io/cni: "false"
    features.operators.openshift.io/cnf: "false"
    features.operators.openshift.io/csi: "false"
    alm-examples: |-
      [
        {
          "apiVersion": "operator.knative.dev/v1beta1",
          "kind": "KnativeServing",
          "metadata": {
            "name": "knative-serving"
          },
          "spec": {
          }
        },
        {
          "apiVersion": "operator.knative.dev/v1beta1",
          "kind": "KnativeEventing",
          "metadata": {
            "name": "knative-eventing"
          },
          "spec": {
          }
        },
        {
          "apiVersion": "operator.serverless.openshift.io/v1alpha1",
          "kind": "KnativeKafka",
          "metadata": {
            "name": "knative-kafka"
          },
          "spec": {
            "broker": {
              "enabled": false,
              "defaultConfig": {
                "numPartitions": 10,
                "replicationFactor": 3,
                "bootstrapServers": "REPLACE_WITH_COMMA_SEPARATED_KAFKA_BOOTSTRAP_SERVERS"
              }
            },
            "source": {
              "enabled": false
            },
            "sink": {
              "enabled": false
            },
            "channel": {
              "enabled": false,
              "bootstrapServers": "REPLACE_WITH_COMMA_SEPARATED_KAFKA_BOOTSTRAP_SERVERS"
            }
          }
        }
      ]
    capabilities: Full Lifecycle
    categories: Networking,Integration & Delivery,Cloud Provider,Developer Tools
    certified: "false"
    createdAt: "2020-04-20T17:00:00Z"
    description: |-
      Deploy and manage event-driven serverless applications and functions using Knative.
    repository: https://github.com/openshift-knative/serverless-operator
    support: Red Hat
    olm.skipRange:
  labels:
    operatorframework.io/arch.amd64: supported
    operatorframework.io/arch.ppc64le: supported
    operatorframework.io/arch.s390x: supported
    operatorframework.io/arch.arm64: supported
  name:
  namespace: placeholder
spec:
  # User-facing metadata
  displayName: Red Hat OpenShift Serverless
  description: |-
    The Red Hat OpenShift Serverless operator provides a collection of APIs that
    enables containers, microservices and functions to run "serverless".
    Serverless applications can scale up and down (to zero) on demand and be triggered by a
    number of event sources. OpenShift Serverless integrates with a number of
    platform services, such as Monitoring and it is based on the open
    source project Knative.

    # Prerequisites
    Knative Serving (and Knative Eventing respectively) can only be installed into the
    `knative-serving` (`knative-eventing`) namespace. These namespaces will be
    automatically created when installing the operator.

    The components provided with the OpenShift Serverless operator require minimum cluster sizes on
    OpenShift Container Platform. For more information, see the documentation on [Getting started
    with OpenShift Serverless](https://docs.redhat.com/en/documentation/red_hat_openshift_serverless/__VERSION_MAJOR_MINOR__/html/serving/getting-started-with-knative-serving#serverless-applications).

    # Supported Features
    - **Easy to get started:** Provides a simplified developer experience to deploy
      and run cloud native applications on Kubernetes, providing powerful
      abstractions.
    - **Immutable Revisions:** Deploy new features performing canary, A/B or
      blue-green testing with gradual traffic rollout following best practices.
    - **Use any programming language or runtime of choice:** From Java, Python, Go
      and JavaScript to Quarkus, SpringBoot or Node.js.
    - **Automatic scaling:** Removes the requirement to configure numbers of replicas
      or idling behavior. Applications automatically scale to zero when not in use,
      or scale up to meet demand, with built in reliability and fault tolerance.
    - **Event Driven Applications:** You can build loosely coupled, distributed applications
      that can be connected to a variety of either built in or third party event sources,
      powered by operators.
    - **Ready for the hybrid cloud:** Provides true, portable serverless functionality,
      that can run anywhere OpenShift Container Platform runs. You can leverage data
      locality and SaaS as you need it.

    # Components & APIs
    This operator provides the following components:

    ## Knative Serving
    Knative Serving builds on Kubernetes to support deploying and serving of applications and functions as serverless containers.
    Serving simplifies the application deployment, dynamically scales based on in incoming traffic and supports custom rollout strategies with traffic splitting.
    Other features include:
    - Simplified deployment of serverless containers
    - Traffic-based auto-scaling, including scale-to-zero
    - Routing and network programming
    - Point-in-time application snapshots and their configurations

    ## Knative Eventing
    Knative Eventing provides a platform that offers composable primitives to enable late-binding event sources and
    event consumers.
    Knative Eventing supports the following architectural cloud-native concepts:

    - Services are loosely coupled during development and deployed independently to production
    - A producer can generate events before a consumer is listening, and a consumer can express an interest in an event or class of events that are not yet being produced.
    - Services can be connected to create new applications without modifying producer or consumer, and with the ability to select a specific subset of events from a particular producer.

    ## Knative Functions
    Knative Functions allows developers to write functions that let them focus on business logic.
    These functions are deployed as Knative Services and take advantage of Knative Serving and Eventing.
    Knative Functions bring greater efficiency, more scalability and faster development to facilitate rapid go-to-market.

    Other features include:
    - Build strategies including Source-to-Image (S2I) and Buildpacks
    - Multiple runtimes, including Node.js, Quarkus and Go
    - Local developer experience through the kn CLI
    - Project templates
    - Support for receiving CloudEvents and plain HTTP requests

    ## Knative CLI `kn`
    The Knative client `kn` allows you to create Knative resources from the command line or from within
    Shell scripts.
    With its extensive help pages and autocompletion support, it frees you from memorizing the detailed structure of the Knative resource schemas.

    `kn` offers you:
    - Full support for managing all features of Knative Serving: Services, Revisions and Routes
    - Support for managing Knative Eventing entities: Sources, Brokers, Triggers, Channels and Subscriptions
    - A kubectl-like plugin architecture to extend the built-in functionality
    - Easy integration of Knative into Tekton pipelines by using `kn` in a Tekton task
    - Create, build and deploy Knative Functions for multiple runtimes, including Node.js, Quarkus, and Go

    # Further Information
    For documentation on OpenShift Serverless, see:
    - [Installation
    Guide](https://docs.redhat.com/en/documentation/red_hat_openshift_serverless/__VERSION_MAJOR_MINOR__/html/installing_openshift_serverless/index)
    - [Develop Serverless Applications](https://docs.redhat.com/en/documentation/red_hat_openshift_serverless/__VERSION_MAJOR_MINOR__/html/serving/getting-started-with-knative-serving#serverless-applications)
  icon:
    - base64data: PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzOCIgaGVpZ2h0PSIzOCIgdmlld0JveD0iMCAwIDM4IDM4Ij48ZGVmcz48c3R5bGU+LmF7ZmlsbDojZmZmO30uYntmaWxsOiNlMDA7fTwvc3R5bGU+PC9kZWZzPjxwYXRoIGNsYXNzPSJhIiBkPSJNMjgsMUgxMGE5LDksMCwwLDAtOSw5VjI4YTksOSwwLDAsMCw5LDlIMjhhOSw5LDAsMCwwLDktOVYxMGE5LDksMCwwLDAtOS05WiIvPjxwYXRoIGQ9Ik0yOCwyLjI1QTcuNzU4Nyw3Ljc1ODcsMCwwLDEsMzUuNzUsMTBWMjhBNy43NTg3LDcuNzU4NywwLDAsMSwyOCwzNS43NUgxMEE3Ljc1ODcsNy43NTg3LDAsMCwxLDIuMjUsMjhWMTBBNy43NTg3LDcuNzU4NywwLDAsMSwxMCwyLjI1SDI4TTI4LDFIMTBhOSw5LDAsMCwwLTksOVYyOGE5LDksMCwwLDAsOSw5SDI4YTksOSwwLDAsMCw5LTlWMTBhOSw5LDAsMCwwLTktOVoiLz48cGF0aCBjbGFzcz0iYiIgZD0iTTE0LDIzLjQ3NjZIMTBhLjYyNTMuNjI1MywwLDAsMS0uNjI1LS42MjV2LTRhLjYyNTIuNjI1MiwwLDAsMSwuNjI1LS42MjVoNGEuNjI1Mi42MjUyLDAsMCwxLC42MjUuNjI1djRBLjYyNTMuNjI1MywwLDAsMSwxNCwyMy40NzY2Wm0tMy4zNzUtMS4yNWgyLjc1di0yLjc1aC0yLjc1WiIvPjxwYXRoIGNsYXNzPSJiIiBkPSJNMjEsMjMuNDc2NkgxN2EuNjI1My42MjUzLDAsMCwxLS42MjUtLjYyNXYtNGEuNjI1Mi42MjUyLDAsMCwxLC42MjUtLjYyNWg0YS42MjUyLjYyNTIsMCwwLDEsLjYyNS42MjV2NEEuNjI1My42MjUzLDAsMCwxLDIxLDIzLjQ3NjZabS0zLjM3NS0xLjI1aDIuNzV2LTIuNzVoLTIuNzVaIi8+PHBhdGggY2xhc3M9ImIiIGQ9Ik0xNy41LDE2LjQ3NjZoLTRhLjYyNTMuNjI1MywwLDAsMS0uNjI1LS42MjV2LTRhLjYyNTIuNjI1MiwwLDAsMSwuNjI1LS42MjVoNGEuNjI1Mi42MjUyLDAsMCwxLC42MjUuNjI1djRBLjYyNTMuNjI1MywwLDAsMSwxNy41LDE2LjQ3NjZabS0zLjM3NS0xLjI1aDIuNzV2LTIuNzVoLTIuNzVaIi8+PHBhdGggY2xhc3M9ImIiIGQ9Ik0yNC41LDE2LjQ3NjZoLTRhLjYyNTMuNjI1MywwLDAsMS0uNjI1LS42MjV2LTRhLjYyNTIuNjI1MiwwLDAsMSwuNjI1LS42MjVoNGEuNjI1Mi42MjUyLDAsMCwxLC42MjUuNjI1djRBLjYyNTMuNjI1MywwLDAsMSwyNC41LDE2LjQ3NjZabS0zLjM3NS0xLjI1aDIuNzV2LTIuNzVoLTIuNzVaIi8+PHBhdGggY2xhc3M9ImIiIGQ9Ik0yOCwyMy40NzY2SDI0YS42MjUzLjYyNTMsMCwwLDEtLjYyNS0uNjI1di00YS42MjUyLjYyNTIsMCwwLDEsLjYyNS0uNjI1aDRhLjYyNTIuNjI1MiwwLDAsMSwuNjI1LjYyNXY0QS42MjUzLjYyNTMsMCwwLDEsMjgsMjMuNDc2NlptLTMuMzc1LTEuMjVoMi43NXYtMi43NWgtMi43NVoiLz48cGF0aCBkPSJNMjksMjYuNDc2Nkg5YS42MjUuNjI1LDAsMCwxLDAtMS4yNUgyOWEuNjI1LjYyNSwwLDAsMSwwLDEuMjVaIi8+PC9zdmc+
      mediatype: image/svg+xml
  installModes:
    - supported: false
      type: OwnNamespace
    - supported: false
      type: SingleNamespace
    - supported: false
      type: MultiNamespace
    - supported: true
      type: AllNamespaces
  keywords:
    - serverless
    - FaaS
    - microservices
    - scale to zero
    - knative
    - serving
    - eventing
    - kafka
  links:
    - name: Documentation
      url: https://access.redhat.com/documentation/en-us/openshift_container_platform/__OCP_TARGET__/html/serverless/index
    - name: Source Repository
      url: https://github.com/openshift-knative/serverless-operator
  maintainers:
    - email: support@redhat.com
      name: Serverless Team
  maturity: stable
  provider:
    name: Red Hat

  minKubeVersion:

  customresourcedefinitions:
    owned:
      - description: A platform for streamlined application deployment, traffic-based auto-scaling from zero to N, and traffic-split rollouts
        displayName: Knative Serving
        kind: KnativeServing
        name: knativeservings.operator.knative.dev
        statusDescriptors:
          - description: The version of Knative Serving installed
            displayName: Version
            path: version
          - description: Conditions of Knative Serving installed
            displayName: Conditions
            path: conditions
            x-descriptors:
              - "urn:alm:descriptor:io.kubernetes.conditions"
        version: v1beta1
      - description: An event-driven application platform that leverages CloudEvents with a simple HTTP interface
        displayName: Knative Eventing
        kind: KnativeEventing
        name: knativeeventings.operator.knative.dev
        statusDescriptors:
          - description: The version of Knative Eventing installed
            displayName: Version
            path: version
        version: v1beta1
      - description: An extension to Knative Eventing, merging HTTP accessibility with Apache Kafka's proven efficiency and reliability
        displayName: Knative Kafka
        kind: KnativeKafka
        name: knativekafkas.operator.serverless.openshift.io
        version: v1alpha1

  install:
    strategy: deployment
    spec:
      clusterPermissions:
        - serviceAccountName: knative-openshift
          rules:
            - apiGroups:
                - sources.knative.dev
              resources:
                - kafkasources
                - kafkasinks
              verbs:
                - get
                - list
                - watch
            - apiGroups:
                - ""
              resources:
                - configmaps
                - events
                - namespaces
                - serviceaccounts
                - services
                - secrets
                - endpoints
                - pods
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
            - apiGroups:
                - apps
              resources:
                - deployments
                - deployments/finalizers # For monitoring resources to set their ownerRef correctly
                - statefulsets
                - statefulsets/finalizers # For monitoring resources to set their ownerRef correctly
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
            - apiGroups:
                - autoscaling
              resources:
                - horizontalpodautoscalers
              verbs:
                - create
                - delete
                - get
                - list
            - apiGroups:
                - batch
              resources:
                - jobs
              verbs:
                - create
                - delete
                - get
                - list
                - watch
                - update
            - apiGroups:
                - policy
              resources:
                - poddisruptionbudgets
              verbs:
                - create
                - delete
                - get
                - list
                - update
            - apiGroups:
                - rbac.authorization.k8s.io
              resources:
                - clusterroles
                - roles
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
                # Escalate is necessary in order to create a role using cluster role aggregation,
                # and to allow the Operator to bootstrap itself into the necessary set of permissions
                # Bind is needed to bind roles and clusterRoles, with permissions
                # that the operator itself does not hold
                - escalate
                - bind
            - apiGroups:
                - rbac.authorization.k8s.io
              resources:
                - clusterrolebindings
                - rolebindings
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
            - apiGroups:
                - admissionregistration.k8s.io
              resources:
                - mutatingwebhookconfigurations
                - validatingwebhookconfigurations
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
            - apiGroups:
                - networking.k8s.io
              resources:
                - networkpolicies
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
            - apiGroups:
                - apiextensions.k8s.io
              resources:
                - customresourcedefinitions
                - customresourcedefinitions/status
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
            - apiGroups:
                - caching.internal.knative.dev
              resources:
                - images
              verbs:
                - create
                - delete
                - get
                - list
                - update
            # Downstream additions
            - apiGroups:
                - monitoring.coreos.com
              resources:
                - servicemonitors
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
            - apiGroups:
                - console.openshift.io
              resources:
                - consolequickstarts
                - consoleclidownloads
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
            - apiGroups:
                - config.openshift.io
              resources:
                - clusteroperators
                - clusteroperators/status
              verbs:
                - "get"
                - "watch"
                - "list"
            - apiGroups:
                - route.openshift.io
              resources:
                - routes
                - routes/custom-host
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
            # Leases are needed for leaderelection to work
            - apiGroups:
                - coordination.k8s.io
              resources:
                - leases
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
            # These are resources we own
            - apiGroups:
                - operator.knative.dev
              resources:
                - knativeservings
                - knativeservings/status
                - knativeservings/finalizers
                - knativeeventings
                - knativeeventings/status
                - knativeeventings/finalizers
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
                - patch
            - apiGroups:
                - operator.serverless.openshift.io
              resources:
                - knativekafkas
                - knativekafkas/status
                - knativekafkas/finalizers
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
                - patch
            # These resources we only read
            - apiGroups:
                - config.openshift.io
              resources:
                - ingresses
              verbs:
                - get
                - list
                - watch
            # Eventing TLS
            - apiGroups:
                - "cert-manager.io"
              resources:
                - certificates
                - issuers
                - clusterissuers
              verbs:
                - create
                - delete
                - update
                - list
                - get
                - watch
        - serviceAccountName: knative-operator
          rules:
            # These are needed to create the various different resources.
            # Upstream manifests
            - apiGroups:
                - ""
              resources:
                - configmaps
                - namespaces
                - secrets
                - serviceaccounts
                - services
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
            - apiGroups:
                - ""
              resources:
                - events
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
                - patch
            - apiGroups:
                - apps
              resources:
                - deployments
                - deployments/finalizers # For monitoring resources to set their ownerRef correctly
                - statefulsets
                - statefulsets/finalizers # For monitoring resources to set their ownerRef correctly
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
            - apiGroups:
                - autoscaling
              resources:
                - horizontalpodautoscalers
              verbs:
                - create
                - delete
                - get
                - list
                - update
            - apiGroups:
                - batch
              resources:
                - jobs
              verbs:
                - create
                - delete
                - get
                - list
                - watch
                - update
            - apiGroups:
                - policy
              resources:
                - poddisruptionbudgets
              verbs:
                - create
                - delete
                - get
                - list
                - update
            - apiGroups:
                - rbac.authorization.k8s.io
              resources:
                - clusterroles
                - roles
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
                # Escalate is necessary in order to create a role using cluster role aggregation,
                # and to allow the Operator to bootstrap itself into the necessary set of permissions
                # Bind is needed to bind roles and clusterRoles, with permissions
                # that the operator itself does not hold
                - escalate
                - bind
            - apiGroups:
                - rbac.authorization.k8s.io
              resources:
                - clusterrolebindings
                - rolebindings
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
            - apiGroups:
                - admissionregistration.k8s.io
              resources:
                - mutatingwebhookconfigurations
                - validatingwebhookconfigurations
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
            - apiGroups:
                - networking.k8s.io
              resources:
                - networkpolicies
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
            - apiGroups:
                - apiextensions.k8s.io
              resources:
                - customresourcedefinitions
                - customresourcedefinitions/status
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
            - apiGroups:
                - caching.internal.knative.dev
              resources:
                - images
              verbs:
                - create
                - delete
                - get
                - list
                - update
            # Downstream additions
            - apiGroups:
                - monitoring.coreos.com
              resources:
                - servicemonitors
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
            - apiGroups:
                - console.openshift.io
              resources:
                - consolequickstarts
                - consoleclidownloads
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
            - apiGroups:
                - config.openshift.io
              resources:
                - clusteroperators
                - clusteroperators/status
              verbs:
                - get
                - watch
                - list
            - apiGroups:
                - route.openshift.io
              resources:
                - routes
                - routes/custom-host
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch

            # Leases are needed for leaderelection to work
            - apiGroups:
                - coordination.k8s.io
              resources:
                - leases
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch

            # These are resources we own
            - apiGroups:
                - operator.knative.dev
              resources:
                - knativeservings
                - knativeservings/status
                - knativeservings/finalizers
                - knativeeventings
                - knativeeventings/status
                - knativeeventings/finalizers
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
                - patch
            - apiGroups:
                - operator.serverless.openshift.io
              resources:
                - knativekafkas
                - knativekafkas/status
                - knativekafkas/finalizers
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch
                - patch

            # These resources we only read
            - apiGroups:
                - config.openshift.io
              resources:
                - ingresses
              verbs:
                - get
                - list
                - watch
            # Eventing TLS
            - apiGroups:
                - "cert-manager.io"
              resources:
                - certificates
                - issuers
                - clusterissuers
              verbs:
                - create
                - delete
                - update
                - list
                - get
                - watch

            - apiGroups:
                - networking.internal.knative.dev
              resources:
                - certificates
              verbs:
                - create
                - delete
                - update
                - get
                - list
                - watch

        - serviceAccountName: knative-openshift-ingress
          rules:
            - apiGroups:
                - ""
              resources:
                - events
              verbs:
                - create
                - delete
                - get
                - list
            - apiGroups:
                - ""
              resources:
                - configmaps
              verbs:
                - get
                - list
                - watch
            - apiGroups:
                - networking.internal.knative.dev
              resources:
                - ingresses
                - ingresses/finalizers
              verbs:
                - get
                - list
                - watch
                - patch # for the finalizer
            - apiGroups:
                - route.openshift.io
              resources:
                - routes
                - routes/custom-host
              verbs:
                - create
                - delete
                - get
                - list
                - update
                - watch

      deployments:
        # Our version of the upstream operator. This is responsible for installing Knative
        # itself.
        - name: knative-operator-webhook
          spec:
            replicas: 1
            selector:
              matchLabels:
                name: knative-operator
                serverless.openshift.io/is: webhook
            template:
              metadata:
                labels:
                  name: knative-operator
                  serverless.openshift.io/is: webhook
                  sidecar.istio.io/inject: "false"
              spec:
                serviceAccountName: knative-operator
                containers:
                  - name: knative-operator
                    image:
                    readinessProbe:
                      periodSeconds: 1
                      httpGet:
                        scheme: HTTPS
                        port: 8443
                        httpHeaders:
                          - name: k-kubelet-probe
                            value: "webhook"
                      livenessProbe:
                        periodSeconds: 1
                        httpGet:
                          scheme: HTTPS
                          port: 8443
                          httpHeaders:
                            - name: k-kubelet-probe
                              value: "webhook"
                        failureThreshold: 6
                        initialDelaySeconds: 20
                    imagePullPolicy: Always
                    ports:
                      - containerPort: 9090
                        name: metrics
                      - containerPort: 8443
                        name: https-webhook
                    env:
                      - name: POD_NAME
                        valueFrom:
                          fieldRef:
                            fieldPath: metadata.name
                      - name: OPERATOR_NAME
                        value: knative-operator
                      - name: SYSTEM_NAMESPACE
                        valueFrom:
                          fieldRef:
                            fieldPath: metadata.namespace
                      - name: METRICS_DOMAIN
                        value: knative.dev/serving-operator
                      - name: REQUIRED_SERVING_NAMESPACE
                        value: "knative-serving"
                      - name: REQUIRED_SERVING_INGRESS_NAMESPACE
                        value: "knative-serving-ingress"
                      - name: REQUIRED_EVENTING_NAMESPACE
                        value: "knative-eventing"
                      - name: SERVICE_MONITOR_RBAC_MANIFEST_PATH
                        value: "/var/run/ko/monitoring/rbac-proxy.yaml"
                      - name: WEBHOOK_NAME
                        value: "knative-operator-service"
                      - name: USE_OLM_TLS
                        value: "true"
                      - name: KUBERNETES_MIN_VERSION
                        value: "v1.0.0"
                    securityContext:
                      allowPrivilegeEscalation: false
                      readOnlyRootFilesystem: true
                      runAsNonRoot: true
                      capabilities:
                        drop:
                          - ALL
        # Openshift specific extensions in the "old" operator format. Ships KnativeKafka and
        # other Openshift specifica that have not yet been moved to the operator above.
        - name: knative-openshift
          spec:
            replicas: 1
            selector:
              matchLabels:
                name: knative-openshift
            template:
              metadata:
                labels:
                  name: knative-openshift
              spec:
                serviceAccountName: knative-openshift
                initContainers:
                  - name: cli-artifacts
                    image: TO_BE_REPLACED
                    imagePullPolicy: Always
                    command:
                      [
                        "sh",
                        "-c",
                        "rm -rf /cli-artifacts/* && cp /usr/share/kn/**/* /cli-artifacts && chmod 444 /cli-artifacts/*",
                      ]
                    volumeMounts:
                      - mountPath: /cli-artifacts
                        name: cli-artifacts
                    securityContext:
                      allowPrivilegeEscalation: false
                      runAsNonRoot: true
                      capabilities:
                        drop:
                          - ALL
                containers:
                  - name: knative-openshift
                    image:
                    imagePullPolicy: Always
                    readinessProbe:
                      httpGet:
                        path: /readyz
                        port: 8687
                    livenessProbe:
                      httpGet:
                        path: /healthz
                        port: 8687
                    ports:
                      - name: http-cli
                        containerPort: 8080
                    volumeMounts:
                      - mountPath: /cli-artifacts
                        name: cli-artifacts
                    env:
                      - name: WATCH_NAMESPACE
                        value: ""
                      - name: NAMESPACE
                        valueFrom:
                          fieldRef:
                            fieldPath: metadata.namespace
                      - name: DEPLOYMENT_NAME
                        value: "knative-openshift"
                      - name: POD_NAME
                        valueFrom:
                          fieldRef:
                            fieldPath: metadata.name
                      - name: OPERATOR_NAME
                        value: "knative-openshift"
                      - name: REQUIRED_SERVING_NAMESPACE
                        value: "knative-serving"
                      - name: REQUIRED_SERVING_INGRESS_NAMESPACE
                        value: "knative-serving-ingress"
                      - name: REQUIRED_EVENTING_NAMESPACE
                        value: "knative-eventing"
                      - name: REQUIRED_KAFKA_NAMESPACE
                        value: "knative-eventing"
                      - name: KAFKACHANNEL_MANIFEST_PATH
                        value: deploy/resources/knativekafka/channel
                      - name: KAFKASOURCE_MANIFEST_PATH
                        value: deploy/resources/knativekafka/source
                      - name: KAFKACONTROLLER_MANIFEST_PATH
                        value: deploy/resources/knativekafka/controller
                      - name: KAFKABROKER_MANIFEST_PATH
                        value: deploy/resources/knativekafka/broker
                      - name: KAFKASINK_MANIFEST_PATH
                        value: deploy/resources/knativekafka/sink
                      - name: QUICKSTART_MANIFEST_PATH
                        value: "deploy/resources/quickstart/serverless-application-quickstart.yaml"
                      - name: DASHBOARDS_ROOT_MANIFEST_PATH
                        value: "deploy/resources/dashboards"
                      - name: SOURCES_USE_CLUSTER_MONITORING
                        value: "true"
                      - name: SOURCES_GENERATE_SERVICE_MONITORS
                        value: "true"
                      - name: ENABLE_PPROF
                        value: "false"
                      - name: KUBERNETES_MIN_VERSION
                        value: "v1.0.0"
                    securityContext:
                      allowPrivilegeEscalation: false
                      readOnlyRootFilesystem: true
                      runAsNonRoot: true
                      capabilities:
                        drop:
                          - ALL
                volumes:
                  - name: cli-artifacts
                    emptyDir: {}

        # Openshift Ingress adapter for Knative's Ingress implementation.
        - name: knative-openshift-ingress
          spec:
            replicas: 1
            selector:
              matchLabels:
                name: knative-openshift-ingress
            template:
              metadata:
                labels:
                  name: knative-openshift-ingress
              spec:
                serviceAccountName: knative-openshift-ingress
                containers:
                  - name: knative-openshift-ingress
                    image:
                    imagePullPolicy: Always
                    ports:
                      - containerPort: 9090
                        name: metrics
                    env:
                      - name: METRICS_DOMAIN
                        value: knative.dev/serving
                      - name: WATCH_NAMESPACE
                        value: "" # watch all namespaces for ClusterIngress
                      - name: POD_NAME
                        valueFrom:
                          fieldRef:
                            fieldPath: metadata.name
                      - name: OPERATOR_NAME
                        value: "knative-openshift-ingress"
                      - name: SYSTEM_NAMESPACE
                        valueFrom:
                          fieldRef:
                            fieldPath: metadata.namespace
                      - name: KUBERNETES_MIN_VERSION
                        value: "v1.0.0"
                    securityContext:
                      allowPrivilegeEscalation: false
                      readOnlyRootFilesystem: true
                      runAsNonRoot: true
                      capabilities:
                        drop:
                          - ALL

  webhookdefinitions:
    - generateName: validating.knativeeventings.operator.serverless.openshift.io
      type: ValidatingAdmissionWebhook
      deploymentName: knative-openshift
      admissionReviewVersions:
        - v1beta1
      containerPort: 9876
      failurePolicy: Ignore
      rules:
        - apiGroups:
            - operator.knative.dev
          apiVersions:
            - v1beta1
          operations:
            - CREATE
            - UPDATE
          resources:
            - knativeeventings
      sideEffects: None
      webhookPath: /validate-knativeeventings
    - generateName: validating.knativeservings.operator.serverless.openshift.io
      type: ValidatingAdmissionWebhook
      deploymentName: knative-openshift
      admissionReviewVersions:
        - v1beta1
      containerPort: 9876
      failurePolicy: Ignore
      rules:
        - apiGroups:
            - operator.knative.dev
          apiVersions:
            - v1beta1
          operations:
            - CREATE
            - UPDATE
          resources:
            - knativeservings
      sideEffects: None
      webhookPath: /validate-knativeservings
    - generateName: validating.knativekafkas.operator.serverless.openshift.io
      type: ValidatingAdmissionWebhook
      deploymentName: knative-openshift
      admissionReviewVersions:
        - v1beta1
      containerPort: 9876
      failurePolicy: Ignore
      rules:
        - apiGroups:
            - operator.serverless.openshift.io
          apiVersions:
            - v1alpha1
          operations:
            - CREATE
            - UPDATE
          resources:
            - knativekafkas
      sideEffects: None
      webhookPath: /validate-knativekafkas
    - generateName: mutating.knativeeventings.operator.serverless.openshift.io
      type: MutatingAdmissionWebhook
      deploymentName: knative-openshift
      admissionReviewVersions:
        - v1beta1
      containerPort: 9876
      failurePolicy: Ignore
      rules:
        - apiGroups:
            - operator.knative.dev
          apiVersions:
            - v1beta1
          operations:
            - CREATE
            - UPDATE
          resources:
            - knativeeventings
      sideEffects: None
      webhookPath: /mutate-knativeeventings
    - generateName: mutating.knativeservings.operator.serverless.openshift.io
      type: MutatingAdmissionWebhook
      deploymentName: knative-openshift
      admissionReviewVersions:
        - v1beta1
      containerPort: 9876
      failurePolicy: Ignore
      rules:
        - apiGroups:
            - operator.knative.dev
          apiVersions:
            - v1beta1
          operations:
            - CREATE
            - UPDATE
          resources:
            - knativeservings
      sideEffects: None
      webhookPath: /mutate-knativeservings
    - generateName: conversion.knativeservings.operator.knative.dev
      type: ConversionWebhook
      admissionReviewVersions:
        - v1beta1
      containerPort: 8443
      targetPort: 8443
      deploymentName: knative-operator-webhook
      sideEffects: None
      webhookPath: /resource-conversion
      conversionCRDs:
        - knativeservings.operator.knative.dev
    - generateName: conversion.knativeeventings.operator.knative.dev
      type: ConversionWebhook
      admissionReviewVersions:
        - v1beta1
      containerPort: 8443
      targetPort: 8443
      deploymentName: knative-operator-webhook
      sideEffects: None
      webhookPath: /resource-conversion
      conversionCRDs:
        - knativeeventings.operator.knative.dev
  relatedImages:
  replaces:
  version:
